require('dotenv').config();
const { setupDiscordBot } = require("./discord-bot.js");
const web3 = require("./web3.js");
const {decodeInput} = require("./publish-listing");

decodeInput('0x04e85935000000000000000000000000000000000000000000000000000000000000021600000000000000000000000047bff18e462912ab61a465b2bc229e3857491aa60000000000000000000000000000000000000000000000000000000000000001000000000000000000000000ecf2adaff1de8a512f6e8bfe67a2c836edb25da3000000000000000000000000000000000000000000000000000000e8d4a51000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000007b700000000000000000000000029b58a7fceecf0c84e62301e5b933416a1db05990000000000000000000000000000000000000000000000000000000000000e3600000000000000000000000029b58a7fceecf0c84e62301e5b933416a1db0599')

//setupDiscordBot();

web3.eth.subscribe('logs', {
  address: '0xdF5499A17D487345e0201aCE513b26E5F427A717',
  fromBlock: 'latest'
}, function(error, result){
  if (error)
    console.log(error);
  if (!error)
  web3.eth.getTransaction(result.transactionHash).then(async tx => {
    const input = tx.input;
    if (input.startsWith('0xfecb1242')) {
      await decodeInput(input)
    } else if (input.startsWith('0x04e85935')) {
      console.log('buy')
      // should be a buy
      // example of a buy: 
      // https://moonscan.io/tx/0xed9ff3e50ef9add38f19ec01bea6f3ea3860edb8eb0a7e44a57865924c76ef71
      await decodeInput(input);
    }
  })
})


