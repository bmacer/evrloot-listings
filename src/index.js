require('dotenv').config();
const { setupDiscordBot } = require("./discord-bot.js");
const web3 = require("./web3.js");
const {decodeInput} = require("./publish-listing");

setupDiscordBot().then(
  decodeInput("0xfecb1242000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000009840000000000000000000000000000000000000000000000000000000064ac4b32000000000000000000000000000000000000000000000000000000000003141d0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000095492edcc1d373e236e368973285ad47d56d07b6000000000000000000000000ecf2adaff1de8a512f6e8bfe67a2c836edb25da30000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0a73474000000000000000000000000000000000000000000000000000000000000000000")
);

web3.eth.subscribe('logs', {
  address: '0xdF5499A17D487345e0201aCE513b26E5F427A717',
  fromBlock: 'latest'
}, function(error, result){
  if (error)
    console.log(error);
  if (!error)
    console.log('received tx!')
  web3.eth.getTransaction(result.transactionHash).then(async tx => {
    console.log('found transaction with input:', tx.input)

    const input = tx.input;
    if (input.startsWith('0xfecb1242')) {
      console.log('decoding input:', input)

      await decodeInput(input)
    }

  })
})


